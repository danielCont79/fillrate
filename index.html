<!DOCTYPE html>
<html>
    <meta charset="utf-8">
<head>

	<title>FR Map</title>
    <meta charset="utf-8">
	<link rel="shortcut icon" href="images/favicon-02.png">
   

    <!-- JQUERY -->
	
    <script src="js/jquery/jquery.min.js"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="styles/jquery/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="js/d3/3.5.5/d3.min.js"></script>

    <!-- MAPAS -->
    <script src="Build/Cesium/Cesium.js"></script>

    <link rel="stylesheet" href="styles/main.css">

    
    <!-- FUENTES ICONOS -->
   
    <link href='https://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Coda:400,800' rel='stylesheet' type='text/css'>

    <!-- CONTROLS -->
    <script src="js/autocomplete.js"></script>

    <!-- EXPERTOS EN KPI -->
    
    <script src="js/experts/calculateKpiExpert_FR.js"></script>   
    <script src="js/experts/calculateKpiExpert_OOS.js"></script>        
    <script src="js/experts/calculateKpiExpert_OOSFiliales.js"></script> 
    <script src="js/experts/calculateKpiExpert_Mas.js"></script>
    <script src="js/experts/calculateKpiExpert_Ventas.js"></script>
    <script src="js/experts/calculateKpiExpert_Pendientes.js"></script>
    <script src="js/experts/calculateKpiExpert_Abasto.js"></script>
    <script src="js/experts/calculateKpiExpert_Produccion.js"></script>
    <script src="js/experts/drawKpiExpert_ABAS.js"></script>
    <script src="js/experts/reportExpert.js"></script>
    <script src="js/experts/calculateKpiExpert_Flota.js"></script>

    <script src="js/experts/drawKpiExpert_FR.js"></script>
    <script src="js/experts/drawKpiExpert_OOS.js"></script>
    <script src="js/experts/drawKpiExpert_OOS_Filiales.js"></script>
    <script src="js/experts/drawKpiExpert_PROD.js"></script>
    <script src="js/experts/drawKpiExpert_VENTAS.js"></script>
    <script src="js/experts/drawKpiExpert_MAS.js"></script>
    <script src="js/experts/drawKpiExpert_PEN.js"></script>
    <script src="js/experts/drawKpiExpert_Flota.js"></script>

    <script src="js/kpi_date_status.js"></script>
    <script src="js/kpi_windows_context.js"></script>

    <!-- SELECCION MULTIPLE -->
    <script src="js/jquery.multi-select.js" type="text/javascript"></script>
    <link href="styles/multi-select.css" media="screen" rel="stylesheet" type="text/css">

    <!-- CUSTOM -->
    <script src="js/loader.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utilerias.js"></script>
    <script src="js/map.js"></script>    
    <script src="js/store.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/radar.js"></script>
    <script src="js/radarMosaic.js"></script>
    <script src="js/elementosContexo.js"></script>

    <script src="js/tooltipHelpers.js"></script>
    <script src="js/workersProcessor.js"></script>

    <script src="js/regionesGeoJson.js"></script>

    <link rel='stylesheet' href='./styles/style.css' />
    <script src="https://unpkg.com/gijgo@1.9.14/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.14/css/gijgo.min.css" rel="stylesheet" type="text/css" />


     <!-- VIX_TT  -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
   <style>
       th.sorted {
         background-color: #ffeeba; /* Set the background color for the sorted column */
       }
     
       th:not(.sorted) {
         background-color: transparent; /* Clear the background color for other columns */
       }


       .header-cell {
             color:#8EBBFF;
             border: 0px solid white;
             padding: 8px;
             font-size: 12px;
             text-align: left;
        }

        .body-cell {
             color:#FFFFFF;
             border: 0px solid white;
             padding: 8px;
             font-size: 12px;
        }

        .totals-row {
             color:#ea09e2;
             border: 0px solid rgb(114, 137, 167);
             padding: 8px;
             font-size: 12px;
        }


        .bar-container {
             display: flex;
             align-items: center;
        }


        .key-selector{
             display: flex;
             align-items: center;
        }
        .key-selector:hover{
            color:#000000;
            background-color: lightgray;
            cursor: pointer; 
        }         

        .bar-value {
             margin-left: 1px; /* Add some spacing between the bar and value */
             margin-right: 8px;
             text-align: left;
             min-width: 30px;

        }

         .tooltip-table {
            border-collapse: collapse;
            border: 1px solid #41576b;
            border: 0;
            /* Other styling properties */
        }

        .tooltip-table th, .tooltip-table td {
            padding: 0;
            /* Other cell styling properties */
        }

        .tooltipIcon {
            position: relative;
            display: inline-block;
        }

  

        body::-webkit-scrollbar {
        width: 12px;               /* width of the entire scrollbar */
        }

        body::-webkit-scrollbar-track {
        background: orange;        /* color of the tracking area */
        }

        body::-webkit-scrollbar-thumb {
        background-color: blue;    /* color of the scroll thumb */
        border-radius: 20px;       /* roundness of the scroll thumb */
        border: 3px solid orange;  /* creates padding around scroll thumb */
        }

        .tooltip-text {
            visibility: hidden;
            width: 180px;
            background-color: #1e1e29;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            position: absolute;
            z-index: 9999;
            bottom: -100%;
            left: -150%;
            transform: translateX(-50%);
            opacity: 0;
            font-size: 14px;
            box-shadow: 5px 5px 10px #000000;
            border-style: solid;
            border-color: #1f3b45;
            border-width: 1px;
            right:5px;
        }
        .tooltip-text2 {
            visibility: hidden;
            width: 150px;
            background-color: #1e1e29;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: -100%;
            left: 150%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 14px;
            box-shadow: 5px 5px 10px #000000;
            border-style: solid;
            border-color: #1f3b45;
            border-width: 1px;
            right:5px;
        }
        .tooltipIcon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .tooltipIcon:hover .tooltip-text2 {
            visibility: visible;
            opacity: 1;
        }

        .top-bar-container {
            display: flex;
            justify-content: space-between; /* Align columns at the start and end */
            align-items: center; /* Vertically center items */
            width: 100%; /* Take up the full width of the top bar */
        }

        .top-bar {
            padding: 5px 5px 5px 5px;
        }


        .title-column {
        flex: 1; /* Allow the title column to grow and take available space */
        }

        .icons-column {
                display: flex; /* Use flexbox to control the alignment */
                flex-direction: row; /* Stack items vertically */
                align-items: flex-end; /* Align items to the top */
                
        }
        .collapse-button {
              
            border-block-end: #7CB1B1;		
            border-block-color: #7CB1B1;
            background-color: #7CB1B1;
            border-color: #25a2a2;
            color: #86ffff;
            border-width: 1px;
        }
        .close-button{
            border-block-end: #7CB1B1;		
            border-block-color: #7CB1B1;
            background-color: #7CB1B1;
            border-color: #25a2a2;
            color: #86ffff;
            border-width: 1px;
        }
        .close-button{
            border-block-end: #7CB1B1;		
            border-block-color: #7CB1B1;
            background-color: #7CB1B1;
            border-color: #25a2a2;
            color: #86ffff;
            border-width: 1px;
        }
       
      
  
   </style>

</head>

<style>


.hr{

border: 0;
height: 1px;
background: #333;
background-image: linear-gradient(to right, #cccccc, #000000);
width:100%;
z-index:900;

}

.listado:hover {

color: yellow;

}

.custom-combobox {
    position: relative;
    display: inline-block;
  }
  .custom-combobox-toggle {
    position: absolute;
    top: 0;
    bottom: 0;
    margin-left: -1px;
    padding: 0;
  }
  .custom-combobox-input {
    margin: 0;
    padding: 5px 10px;
  }
  .ui-menu {
    font-size: 10px;
    line-height: 8px;
  }

</style>

<body onresize=" Stage.ReorderLayout();  " >
    <svg>
        <defs>
        
              <filter id='dropshadow' height='140%' width='140%'>
                  <feGaussianBlur in='SourceAlpha' stdDeviation='4'/> <!-- stdDeviation is how much to blur -->
                  <feOffset dx='3' dy='3' result='offsetblur'/> <!-- how much to offset -->
                  <feMerge><feMergeNode/> <!-- this contains the offset blurred image -->
                  <feMergeNode in='SourceGraphic'/> <!-- this contains the element that the filter is applied to --></feMerge>
              </filter>

              <filter id='dropshadowRadar' height='140%' width='140%'>
                <feGaussianBlur in='SourceAlpha' stdDeviation='10'/> <!-- stdDeviation is how much to blur -->
                <feOffset dx='0' dy='6' result='offsetblur'/> <!-- how much to offset -->
                <feMerge><feMergeNode/> <!-- this contains the offset blurred image -->
                <feMergeNode in='SourceGraphic'/> <!-- this contains the element that the filter is applied to --></feMerge>
            </filter>

              <filter id="glow" x="-130%" y="-130%" height="500%" width="500%">
                <feGaussianBlur stdDeviation="5" result="coloredBlur"/>
                <feMerge>
                <feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>    
              
              <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:1" />
                <stop offset="80%" style="stop-color:rgb(0,0,0);stop-opacity:0" />
               </linearGradient>
             
              <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />
                <stop offset="80%" style="stop-color:rgb(0,0,0);stop-opacity:1" />
               </linearGradient>

               <filter id='dropshadowText' height='140%' width='140%'>
                <feGaussianBlur in='SourceAlpha' stdDeviation='3'/> <!-- stdDeviation is how much to blur -->
                <feOffset dx='1' dy='1' result='offsetblur'/> <!-- how much to offset -->
                <feMerge><feMergeNode/> <!-- this contains the offset blurred image -->
                <feMergeNode in='SourceGraphic'/> <!-- this contains the element that the filter is applied to --></feMerge>
                </filter>
        </defs>
        </svg>
        <div id="version"  style="color:gray;opacity:1;font-family: Cabin;font-size:11px;position:fixed;top:70px;left:10px;z-index:9999">V. BETA 30</div>

        <div style="position:fixed;z-index:-10;float:left;top:0px;pointer-events:none;height:100%;width:100%;background:linear-gradient(#000000, #000000);"></div>

        <div style="position:fixed;z-index:-10;float:left;top:0px;pointer-events:none;height:100%;width:100%;background:linear-gradient(#000000, #000000);"></div>

        <div id="cesiumContainer" style="position:fixed;top:0px;z-index:1;background-color: black"></div>
        
        <img id="logo" src="images/logo1.png" style="position:fixed;z-index:999999;width:140px;float:left;left:10px;top:11px;pointer-events: none;visibility:visible;"></img>
        
        <div class="tooltipIcon" style="position:fixed;z-index:9999;width:31px;float:left;right:5px;bottom:36px;pointer-events: auto;visibility:visible;"><a href="https://visualinteractor.azurewebsites.net/customers/cemex/help/fillrate/" target="_blank"><img id="" src="images/info.png" style="width:20px;"></img></a><div class="tooltip-text">Guia de uso del visualizador</div></div>
        <div class="tooltipIcon" style="position:fixed;z-index:999999;width:31px;float:left;right:5px;bottom:96px;pointer-events: auto;visibility:visible;"><a onclick="kpi_date_status.loadData(true);"><img id="dates_img" src="images/dates.png" style="width:20px;"></img></a><div class="tooltip-text">Fechas disponibles por KPI</div></div>
        <div class="tooltipIcon" style="position:fixed;z-index:99999;width:31px;float:left;right:7px;bottom:65px;pointer-events: auto;visibility:visible;"><a href="https://forms.office.com/r/vKYCMHqze6" target="_blank"><img id="" src="images/ico soporte 01.png" style="width:25px;"></img></a><div class="tooltip-text">Reporte de incidencias</div></div>
      
        <img id="simbologia" src="images/simbologia FR.png" style="width:366px;position:fixed;float:left;right:38px;bottom:2px;pointer-events: none;z-index:999;visibility:visible;"></img>

        <img id="cargando" src="images/preloader araña 5.gif" style="width:100px;position:fixed;float:left;left:50%;top:7%;pointer-events: none;z-index:99999;visibility:hidden;padding:30px;opacity:1"></img>


        <div id="toolTip" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: rgba(0, 0, 0,.6) 5px 10px 19px;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:0px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip2" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip3" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip4" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip5" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip6" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip7" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTipLoader" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: rgba(0, 0, 0,.4) 5px 15px 16px ;color:white;font-size:19px;font-weight:normal;z-index:99999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden;"></div>

        <svg id="svgLines"  height="100%" width="100%" style="position:fixed;top:0;left:0px;pointer-events: none;z-index:8000"/>
        <svg id="svgLines2"  height="100%" width="100%" style="position:fixed;top:0;left:0px;pointer-events: none;z-index:9999999"/>

        <ul class="fa-ul" style="position:absolute;right:0px;top:-4px;color:rgb(255, 255, 255);z-index:99999;font-family:Cabin;right:0px;width: 233px;    direction: initial;    display: flow;">
            <div class="tooltipIcon"><img id="cargando" src="images/Home.png" onclick=" $('#nivel_cb').val(config.nivelInicial); Stage.GoHome(); filterControls.CleanFields(true);filterControls.SetDefaultValues(); forzarFiltrado=true;filterControls.FilterData();  $('#Controls2').css('visibility','hidden'); " style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Limpiar Filtros y Ubicar Mapa</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/SizeIncrease.png" onclick="escalado=escalado*(1.3);Stage.DrawMapObjects(currentEntities,store.mainDataset);" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Tamaño barras</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/Sizedecrease.png" onclick="escalado=escalado*(.7);Stage.DrawMapObjects(currentEntities,store.mainDataset);" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Tamaño barras</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/hexagons_.png" onclick="radar.DecreaseRadars();" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Disminuir Columnas</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/hexagons.png" onclick="radar.IncreaseRadars();" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Aumentar Columnas</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/increase.png" onclick="radar.escalado=radar.escalado*(1.1);radar.DrawEntities(radar.lastRadarEntities);" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Aumentar tamaño Araña</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/decrease.png" onclick="radar.escalado=radar.escalado*(.9);radar.DrawEntities(radar.lastRadarEntities);" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Disminuir tamaño Araña</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/fontSize1.png" onclick="escalaTextos=escalaTextos*(1.1);if(kpiExpert_FR){kpiExpert_FR.DrawMainHeader(); kpiExpert_FR.DrawFilteredHeader();filterControls.showActiveFilters();}" style="width:13px ;float:left;margin:8px"></img><div class="tooltip-text">Tamaño texto</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/fontSize2.png" onclick="escalaTextos=escalaTextos*(.9);if(kpiExpert_FR){kpiExpert_FR.DrawMainHeader(); kpiExpert_FR.DrawFilteredHeader();filterControls.showActiveFilters();}" style="width:13px ;float:left;margin:8px"></img><div class="tooltip-text">Tamaño texto</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/chemical.png" onclick="if(store.fillRate){$('#Controls').css('visibility','visible');}" style="width:13px;float:left;margin:8px"></img><div class="tooltip-text">Filtros</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/calendar.png" onclick="Stage.ToogleCalendar()" style="width:13px ;float:left;margin:8px"></img><div class="tooltip-text">Cambiar Fechas</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/analyticsx.png" onclick='$("#toolTip4").css("visibility")=="visible"? reportExpert.EraseReport()  : reportExpert.DrawReport(entities)' style="width:13px;float:left;margin:8px"></img><div class="tooltip-text">Informe Final</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/mosaic.png" onclick='radarMosaic.toogle();' style="width:13px;float:left;margin:8px"></img><div class="tooltip-text">Vista Mosaico Radares</div></div>
            
        </ul>

        <ul class="fa-ul" style="position:absolute;right:2px;top:25px;color:rgb(255, 255, 255);z-index:9999;font-family:Cabin;right:245px;">
            
            <div class="tooltipIcon"><img id="iconFR" class="iconKPI" src="images/mode1_.png" onclick="dataManager.CambiaModoKPI('FR')" style="width:30px ;float:left;margin:8px" ></img><div class="tooltip-text">Cambiar a Fillrate</div></div>
            <div class="tooltipIcon"><img id="iconOOSF" class="iconKPI" src="images/mode_2.png" onclick="dataManager.CambiaModoKPI('OOS F')" style="width:30px ;float:left;margin:8px"></img><div class="tooltip-text">Cambiar a OOS Fliliales</div></div>
            <div class="tooltipIcon"><img id="iconVenta" class="iconKPI" src="images/mode_3.png" onclick="dataManager.CambiaModoKPI('Venta')" style="width:30px;float:left;margin:8px"></img><div class="tooltip-text">Cambiar a Ventas</div></div>
            <div class="tooltipIcon"><img id="iconOOSF_" class="iconKPI" src="images/mode_2.png" onclick="" style="width:30px ;float:left;margin:8px;opacity:.4"></img><div class="tooltip-text"></div></div>
            <div class="tooltipIcon"><img id="iconVenta_" class="iconKPI" src="images/mode_3.png" onclick="" style="width:30px;float:left;margin:8px;opacity:.4"></img><div class="tooltip-text"></div></div>

        </ul>

        <ul class="fa-ul" style="position:fixed;left:-12px;top:70px;color:rgb(255, 255, 255);z-index:999999;font-family:Cabin;">
            
            <div class="tooltipIcon"><img id="ordenVol" class="iconKPI" src="images/order1_.png" onclick="ordenRadares='Vol';radar.DrawEntities();" style="width:23px ;float:left;margin:8px" ></img><div class="tooltip-text2">Ordenar por Volumen Entregado</div></div>
            <div class="tooltipIcon"><img id="ordenFR" class="iconKPI" src="images/order2.png" onclick="ordenRadares='FR';radar.DrawEntities();" style="width:23px ;float:left;margin:8px" ></img><div class="tooltip-text2">Ordenar por FillRate</div></div>
            <div class="tooltipIcon"><img id="ordenOOS" class="iconKPI" src="images/order5.png" onclick="ordenRadares='OOS';radar.DrawEntities();" style="width:23px ;float:left;margin:8px"></img><div class="tooltip-text2">Ordenar por OOS CED</div></div>
            <div class="tooltipIcon"><img id="ordenOOSF" class="iconKPI" src="images/order3.png" onclick="ordenRadares='OOSF';radar.DrawEntities();" style="width:23px ;float:left;margin:8px"></img><div class="tooltip-text2">Ordenar por OOS Filiales</div></div>
            <div class="tooltipIcon"><img id="ordenVen" class="iconKPI" src="images/order4.png" onclick="ordenRadares='Ven';radar.DrawEntities();" style="width:23px;float:left;margin:8px"></img><div class="tooltip-text2">Ordenar por Ventas</div></div>

        </ul>

        <div id="titulo" class="sombra" align="left" style="position:fixed;top:6px;left:168px;font-family:Cabin;pointer-events:none;font-size:21px;color:#7DDFFF;opacity:1;font-weight:bold;z-index:9999;    line-height: 17px;"/> 
        
        </div>


        <ul class="fa-ul" style="position:absolute;right:230px;top:-15px;color:rgb(255, 255, 255);z-index:99999;font-family:Cabin">   
            
            <img id="back_btn" src="images/back_icon.png" onclick="filterControls.back()" style="width:37px;float:left;margin:8px;visibility:hidden"></img>

        </ul>

        <div id="fechasMain" class="item2 loginContainer login-page form " style="float:left;top:120px;margin-top:20px;z-index:9999;visibility:hidden;">

            <div class="dateContainer " style="padding-top: 0px;">
        
                <input id="datepicker" width="100%" placeholder="Desde"/>
                <input id="datepicker2" width="100%" placeholder="A"/>
                </select>
                <br>
               
                <select id="meses_cb" class="loginBtn" id="dateSelect" onchange="setDates(this);">
                  <option value="">Seleccionar Mes</option>                
                  
                  

                </select>

                <br><br>
                <button id="getdata" class="loginBtn" onclick="">Get Data</button>      
            </div>    
    
        </div>

        <ul id="Controls" class="fa-ul" style="width:150px;float:left;position:fixed;top:100px;font-family:Cabin;box-shadow: 5px 5px 20px #000000;right:10px;font-size:11px;z-index:9999999;opacity:1;line-height: 8px;margin:0px;text-transform:uppercase;border-style:solid;border-color:#254650;border-width:1px;color:#000000;background-color:rgba(0,0,0,.9);padding:20px;border-radius:9px;">
        </ul>
        
        <ul id="Controls2" class="fa-ul" style="width:150px;float:left;position:fixed;top:100px;font-family:Cabin;box-shadow: 5px 5px 20px #000000;right:260px;font-size:11px;z-index:9999999;opacity:1;line-height: 8px;margin:0px;text-transform:uppercase;border-style:solid;border-color:#254650;border-width:1px;color:#000000;background-color:rgba(0,0,0,.9);padding:20px;border-radius:9px;">
        </ul>

        <div id="openweathermap-widget-18" style="position:fixed;z-index:999999;left:500px;top:300px;"></div>

    </body>     
  

    <script>


        // Querys a ejecutar por el worker de manera serial :

        const queries = [
            {
                url: "https://uscldv3dwad01.azurewebsites.net/getSP/VIS_Calcular_KPI_Produccion_FillRate?fechaInicio=2023-05-01&fechaFin=2023-05-31&agrupador=Estado",
                id: 1
            },
            {
                url: "https://uscldv3dwad01.azurewebsites.net/getSP/VIS_Calcular_KPI_Abasto_FillRate?fechaInicio=2023-05-01&fechaFin=2023-05-31&agrupador=Estado",
                id: 2
            },
        ];
        


        // Funcion que procesara los datos a recibir (data)

        function processData(id, data) {
            console.log("Procesando query  :", id);
            switch (id) {
                case 1:
                  console.log('query 1');
                  break;
                case 2:
                case 3:
                  console.log('query 3');
                  
                  break;
                default:
                  console.log("id incorrecto");
              }
        }
        

       // llama al procesador sin bloquear el main thread

        processQueriesWithWorker(queries, processData);

    </script> 
   
    <script>
        
        //Editor: Daniel Contreras Calderon

        var windowWidth; 
        var windowHeight; 

        Stage.ReorderLayout();

        var escalaTextos=1;

       
        if(config.modoSoloFillRate){
            //$("#iconOOSF").hide();
            $("#iconVenta").hide();
        }else{
            //$("#iconOOSF_").hide();
            $("#iconVenta_").hide();
        }  

        /*
        if( window.location.href.indexOf("localhost") > -1 || window.location.href.indexOf("preprod") > -1 ){
           // $("#iconOOSF_").hide();
           // $("#iconOOSF").show();
        }
        */

        function setDates(sel)
        {

            var fechaActual=new Date();
            var ayer=new Date(fechaActual.getTime()-((1000*60)*60)*24);

            if(sel){

                if(sel.value!=""){                    

                    var dataSelected=sel.value.split("-");
                    var initDate=new Date(dataSelected[1],dataSelected[0]-1,1);
                    var endDate=LastDayOfMonth(dataSelected[1],dataSelected[0] );

                    if(endDate.getMonth()==fechaActual.getMonth() ){

                        $('#datepicker').val((initDate.getMonth()+1)+"-01-"+initDate.getFullYear());
                        $('#datepicker2').val((ayer.getMonth()+1)+"-"+(ayer.getDate())+"-"+fechaActual.getFullYear());

                    }else{

                        $('#datepicker').val((initDate.getMonth()+1)+"-01-"+initDate.getFullYear());
                        $('#datepicker2').val((endDate.getMonth()+1)+"-"+endDate.getDate()+"-"+endDate.getFullYear());
                       
                    }                  

                    $("#getdata").click();

                }else{
                   
                    $('#datepicker').val((ayer.getMonth()+1)+"-01-"+fechaActual.getFullYear());
                    $('#datepicker2').val((ayer.getMonth()+1)+"-"+(ayer.getDate())+"-"+fechaActual.getFullYear());

                }

            }else{
                    
                    $('#datepicker').val((ayer.getMonth()+1)+"-01-"+fechaActual.getFullYear());
                    $('#datepicker2').val((ayer.getMonth()+1)+"-"+(ayer.getDate())+"-"+fechaActual.getFullYear());
            }

        }

        var fechaActual=new Date();

        //Crea opciones de meses completo para el select de meses
        var mesInicialOpciones=new Date(2023,7);

        for(var i=0 ; i < fechaActual.getTime() ; i++ ){

            var newDate_=new Date( mesInicialOpciones.getFullYear(), mesInicialOpciones.getMonth()+i );

            var dia=((1000*60)*60)*24;

            if(newDate_.getTime() > fechaActual.getTime()-(dia*30))
                break;

            $("#meses_cb").append(
                `  <option value="${newDate_.getMonth()+1}-${newDate_.getFullYear()}"> ${getMes(newDate_.getMonth())}-${newDate_.getFullYear()}</option>  
                `);          
           

        }

        $(function() {

            $('#datepicker').datepicker({format: 'mm-dd-yyyy'});
            $('#datepicker2').datepicker({format: 'mm-dd-yyyy'});            

            $("#cargando").css("visibility","hidden");

            window.document.addEventListener("mousemove", function(event){

                mouse_x=event.pageX;
        
                mouse_y=event.pageY;
        
            });            

            if(fechaActual.getDate() > 5){

                var ayer=new Date(fechaActual.getTime()-((1000*60)*60)*24);

                $('#datepicker').val((ayer.getMonth()+1)+"-01-"+fechaActual.getFullYear());
                $('#datepicker2').val((ayer.getMonth()+1)+"-"+(ayer.getDate())+"-"+fechaActual.getFullYear());

            }else{

                var endDate_=LastDayOfMonth(fechaActual.getFullYear(),fechaActual.getMonth()+1 );

                $('#datepicker').val((fechaActual.getMonth())+"-01-"+fechaActual.getFullYear());
                $('#datepicker2').val((fechaActual.getMonth())+"-"+(endDate_.getDate())+"-"+fechaActual.getFullYear());

            }        

            //$('#datepicker').val("09-01-2023"); $('#datepicker2').val("09-30-2023"); 
            
            $(".datepicker").css("z-index",99999);
              

            $(function() {     
                
                var dateStr_Init=$('#datepicker').val().split("-");
                var dateStr_End=$('#datepicker2').val().split("-");

                dateInit=new Date(dateStr_Init[2],Number(dateStr_Init[0])-1,dateStr_Init[1]);
                dateEnd=new Date(dateStr_End[2],Number(dateStr_End[0])-1,dateStr_End[1]);

                var dataSources=[];

                for(var i=0; i < store.localDataSources.length; i++){
                    if(store.localDataSources[i].onInitLoad ){
                        dataSources.push(store.localDataSources[i]);
                    }
                }

                for(var i=0; i < store.apiDataSources.length; i++){
                    if(store.apiDataSources[i].onInitLoad ){
                        dataSources.push(store.apiDataSources[i]);
                    }
                }

                kpi_date_status.loadData(true);

                dataLoader.LoadInitialData( dataSources ).then(function(){                     
                    
                    DibujaRegiones();

                    DibujaEstados();                                       

                    filterControls.createDataFiltersControls(store.catlogsForFilters);
                    filterControls.createHardCodedControls();                  
                   

                    radar.radarInitStage();

                    if(elementosContextoMapa)
                        elementosContextoMapa.DibujaUNs(); 
                        
                    Stage.ToogleCalendar("on");

                    $('#Controls').css('visibility','hidden');

                    $('#Controls2').css('visibility','hidden');

                    //setTimeout(()=>{$(".loginBtn").click()}, 500); // Se debe asegurar haber cargado catalogos basicos antes de disparra las consultas

                })               

             });
            
            $("#getdata").click(function(){
               
                if( $('#datepicker').val() && $('#datepicker2').val() ){

                    var dateStr_Init=$('#datepicker').val().split("-");
                    var dateStr_End=$('#datepicker2').val().split("-");
    
                    dateInit=new Date(dateStr_Init[2],Number(dateStr_Init[0])-1,dateStr_Init[1]);
                    dateEnd=new Date(dateStr_End[2],Number(dateStr_End[0])-1,dateStr_End[1]);

                    if(dateInit.getTime() > dateEnd.getTime()){

                        alert("La fecha de inicio no puede rebasar fecha de fin");
                        return;

                    }

                    var minuto=1000*60;
                    var dia = (minuto*60)*24;

                    if(dateEnd.getTime() - dateInit.getTime() > dia*62 ){
                        alert("El máximo período de tiempo permitido es de 2 meses");
                        return;
                    }

                    initialized=false;

                    Stage.ToogleCalendar("off");

                    dataManager.ClusterObjects(); 
                    
                    kpi_date_status.loadData();

                }else{
                    alert('Seleccione fechas');
                }
        
            });

            $('#datepicker2').change((e)=>{

                    if( $('#datepicker').val() && $('#datepicker2').val() ){

                        var dateStr_Init=$('#datepicker').val().split("-");
                        var dateStr_End=$('#datepicker2').val().split("-");
        
                        dateInit=new Date(dateStr_Init[2],Number(dateStr_Init[0])-1,dateStr_Init[1]);
                        dateEnd=new Date(dateStr_End[2],Number(dateStr_End[0])-1,dateStr_End[1]);

                            if(dateInit.getTime() > dateEnd.getTime()){

                                if(fechaActual.getDate() > 5){

                                    var ayer=new Date(fechaActual.getTime()-((1000*60)*60)*24);                    
                                   
                                    $('#datepicker2').val((ayer.getMonth()+1)+"-"+(ayer.getDate())+"-"+fechaActual.getFullYear());
                    
                                }else{
                    
                                    var endDate_=LastDayOfMonth(fechaActual.getFullYear(),fechaActual.getMonth()+1 );                    
                                    
                                    $('#datepicker2').val((fechaActual.getMonth())+"-"+(endDate_.getDate())+"-"+fechaActual.getFullYear());
                    
                                }

                                alert("La fecha de inicio no puede rebasar fecha de fin");
                                return;

                            }                                                       

                    }
    
            });

            $('#datepicker').change((e)=>{

                if( $('#datepicker').val() && $('#datepicker2').val() ){

                    var dateStr_Init=$('#datepicker').val().split("-");
                    var dateStr_End=$('#datepicker2').val().split("-");
    
                    dateInit=new Date(dateStr_Init[2],Number(dateStr_Init[0])-1,dateStr_Init[1]);
                    dateEnd=new Date(dateStr_End[2],Number(dateStr_End[0])-1,dateStr_End[1]);

                        if(dateInit.getTime() > dateEnd.getTime()){

                            if(fechaActual.getDate() > 5){

                                var ayer=new Date(fechaActual.getTime()-((1000*60)*60)*24);
                
                                $('#datepicker').val((ayer.getMonth()+1)+"-01-"+fechaActual.getFullYear());                               
                
                            }else{
                
                                var endDate_=LastDayOfMonth(fechaActual.getFullYear(),fechaActual.getMonth()+1 );
                
                                $('#datepicker').val((fechaActual.getMonth())+"-01-"+fechaActual.getFullYear());                               
                
                            } 

                            alert("La fecha de inicio no puede rebasar fecha de fin");
                            return;

                        }                                                       

                }

        });


            new Promise(Stage.initStage).then(
                
            );

        });

        var opacidadCesium=100;

    document.onkeydown = function(event) {
        console.log(event.keyCode);

        //Evalua si el focus esta en alguno de los componentes de forma de Filtros
        for(var e in createdControls){

            if(  $("."+e+" > input").is(":focus")  && event.keyCode==13){
               
                if($("."+e+" > input").val() ==""){
                        $("#"+e).val("");
                }
                forzarFiltrado=true;
                filterControls.FilterData();
                break;
    
            }
        }
        
    
        switch (event.keyCode) {
         
            //MODIFICA TAMAÑO DE CILINDROS
            case 32:   

            /*

                if(!Stage.allowMultipleSelection){
                    Stage.allowMultipleSelection=true;
                
                    Stage.selectedItems={};
                }
                */
              
            break;
            case 39:   
                
            break;
            //MODIFICA OPACIDAD DEL MAPA
            case 40:   
                opacidadCesium-=8;
                $("#cesiumContainer").css("opacity",opacidadCesium/100);
            break;
            case 38:   
                opacidadCesium+=8;
                $("#cesiumContainer").css("opacity",opacidadCesium/100);
            break;
          
           
            case 87:   

                
            break;
            case 83:   
                   

            break;

            case 49:   

                columnasRadar=1;
                radar.DrawEntities(entities);

            break;
            case 50: 

                columnasRadar=2;
                radar.DrawEntities(entities);                  

            break;
            case 51: 

                columnasRadar=3;
                radar.DrawEntities(entities);                  

            break;
            case 52: 

                columnasRadar=4;
                radar.DrawEntities(entities);                  

            break;
            case 53: 

                columnasRadar=5;
                radar.DrawEntities(entities);                  

            break;
            case 54: 

                columnasRadar=6;
                radar.DrawEntities(entities);                  

            break;
            case 55:
          
           
            break;
            case 32: 
            
            break;
    
        }
       
    }
    
    document.onkeyup = function(event) {
    
        switch (event.keyCode) {    
            case 32:

            /*

            Stage.allowMultipleSelection=false;

            var queryInit = confirm("Ha seleccionado los siguiente estados: "+Object.keys(Stage.selectedItems).toString()+", Desea filtrar Datos?");
            if (queryInit) {

                if($("#nivel_cb").val()==0){
                    $("#nivel_cb").val(3);
                };

                $("#cat_estado").val(Object.keys(Stage.selectedItems).toString().replaceAll("'",""));
                $($("#cat_estado").siblings().first()[0].firstChild).val(Object.keys(Stage.selectedItems).toString().replaceAll("'",""));

                dataManager.ClusterObjects();

            } else {
                Stage.CleanSelectedItems();
            }

            */
          
            break;
            case 50:
    
            break;
            case 51:    
    
            break;
    
            case 27:

            document.getElementById('svgLines').focus();

            radar.CleanWindows();

            Stage.RemovePinned();
            
            break;
    
        }
    }
          

    //OPEN WEATHER
    /*

    window.myWidgetParam ? window.myWidgetParam : window.myWidgetParam = [];  

    window.myWidgetParam.push({id: 18,cityid: '3995465',appid: '5ecb05c129c4cba524f02d97ccc0fee1',units: 'metric',containerid: 'openweathermap-widget-18',  });  

    (function() {

        var script = document.createElement('script');
    
        script.async = true;script.charset = "utf-8";script.src = "//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator.js";
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(script, s); 

    })();
*/
    

    </script>